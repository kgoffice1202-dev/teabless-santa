<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Teabless Christmas Gift Quiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Tailwind CDN -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- React / ReactDOM / Babel CDN -->
    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&family=Dancing+Script:wght@700&family=Chewy&family=Zen+Old+Mincho:wght@700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "M PLUS Rounded 1c", sans-serif;
        background-color: #0f281e;
        margin: 0;
      }
      .font-dancing {
        font-family: "Dancing Script", cursive;
      }
      .font-chewy {
        font-family: "Chewy", cursive;
      }
      .font-mincho {
        font-family: "Zen Old Mincho", serif;
      }
      .text-pretty {
        text-wrap: pretty;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      @keyframes fall {
        0% {
          transform: translateY(-20px) rotate(0deg);
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
        }
      }
      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-20px);
        }
      }
      .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(232, 198, 96, 0.3);
        border-radius: 4px;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .animate-fade-in {
        animation: fadeIn 0.8s ease-out forwards;
      }
      .animate-scale-in {
        animation: scaleIn 0.5s ease-out forwards;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
    </style>
  </head>

  <body class="bg-[#0f281e]">
    <div id="root"></div>

    <!-- React ÏΩîÎìú -->
    <script type="text/babel">
      const { useState, useEffect, useRef, useMemo } = React;

      // Íµ¨Í∏Ä Ïï±Ïä§ Ïä§ÌÅ¨Î¶ΩÌä∏ Î∞∞Ìè¨ URL
      const GOOGLE_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbyjaYsCo2n-9SvIGFGggPv25VeIzBc2eB-AcvNtVt3XhNqpg6NC26z5PXifCPc51ZSnSA/exec";

      // ÌÜµÌï© Íµ¨Îß§ ÎßÅÌÅ¨
      const SHOP_LINK = "https://www.qoo10.jp/shop/teabless_official";

      // Ï†úÌíà Îç∞Ïù¥ÌÑ∞
      const PRODUCTS = [
        {
          id: "lily-musk",
          name: "„É™„É™„Éº„É†„Çπ„ÇØ„Éª„Éõ„ÉØ„Ç§„Éà„ÉÜ„Ç£„Éº",
          items: "Lotion, Wash, Hand Cream",
          scent: "Á¥îÁ≤ã„ÅßÊ∏©„Åã„Åø„ÅÆ„ÅÇ„Çã„É†„Çπ„ÇØ„ÅÆÈ¶ô„Çä",
          desc: "„Åæ„Çã„ÅßÈõ™„ÅåÈôç„ÇäÁ©ç„ÇÇ„Å£„ÅüÂ∫≠Âúí„ÅÆ„Çà„ÅÜ„Å™Á¥îÁ≤ã„Åï„ÄÇÊ∏ÖÊΩîÊÑü„ÅÇ„Åµ„Çå„Çã„ÅÇ„ÅÆ‰∫∫„Å´„ÄÅÂÜ¨„ÅÆÊúù„ÅÆ„Çà„ÅÜ„Å™ÊæÑ„Çì„Å†È¶ô„Çä„ÇíË¥à„Çä„Åæ„Åõ„Çì„ÅãÔºü",
          color: "bg-slate-100 text-slate-800",
          accent: "text-slate-500",
          tags: ["„Éî„É•„Ç¢", "„Å¨„Åè„ÇÇ„Çä", "ÂÜ¨„ÅÆÊúù"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/tH2AjAm.png",
        },
        {
          id: "fig-peach",
          name: "„Éï„Ç£„Ç∞„Éî„Éº„ÉÅ„Éª„Ç¶„Éº„É≠„É≥„ÉÜ„Ç£„Éº",
          items: "Lotion, Wash",
          scent: "Áîò„ÅèÁîü„ÅçÁîü„Åç„Å®„Åó„Åü„Éï„É´„Éº„ÉÑ„ÅÆÈ¶ô„Çä",
          desc: "„ÇØ„É™„Çπ„Éû„Çπ„Éë„Éº„ÉÜ„Ç£„Éº„ÅÆ„ÉØ„ÇØ„ÉØ„ÇØÊÑüÔºÅÊÑõ„Çâ„Åó„Åè„Å¶„ÉÅ„É£„Éº„Éü„É≥„Ç∞„Å™„ÅÇ„ÅÆ‰∫∫„Å´„ÅØ„ÄÅÁîò„ÅÑ„Éï„É´„Éº„ÉÑ„ÅÆÈ¶ô„Çä„Åå„Å¥„Å£„Åü„Çä„ÄÇ",
          color: "bg-pink-100 text-pink-900",
          accent: "text-pink-500",
          tags: ["ÊÑõ„Çâ„Åó„Åï", "„Çπ„Ç§„Éº„Éà", "„Éë„Éº„ÉÜ„Ç£„Éº"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/4ZaANsL.png",
        },
        {
          id: "sage-amber",
          name: "„Çª„Éº„Ç∏„Ç¢„É≥„Éê„Éº„Éª„Éë„Éº„Éó„É´„ÉÜ„Ç£„Éº",
          items: "Lotion, Wash",
          scent: "ËêΩ„Å°ÁùÄ„ÅÑ„ÅüÊ∑±„Åø„ÅÆ„ÅÇ„Çã„Ç¶„ÉÉ„Éá„Ç£„Å™È¶ô„Çä",
          desc: "ÊöñÁÇâ„ÅÆ„Åù„Å∞„Åß„Åè„Å§„Çç„Åê„Çà„ÅÜ„Å™ÂÆâÂøÉÊÑü„ÄÇ„ÅÑ„Å§„ÇÇËêΩ„Å°ÁùÄ„ÅÑ„Å¶„ÅÑ„ÇãÂ§ß‰∫∫„Å™„ÅÇ„ÅÆ‰∫∫„Å∏„ÄÅÊ∑±„ÅÑÁôí„Åó„ÅÆÊôÇÈñì„Çí„ÄÇ",
          color: "bg-purple-100 text-purple-900",
          accent: "text-purple-600",
          tags: ["ÂÑ™ÈõÖ", "„Éü„Çπ„ÉÜ„É™„Ç¢„Çπ", "ÈùôÂØÇ"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/WdKvuXf.png",
        },
        {
          id: "blue-mellow",
          name: "„Éñ„É´„Éº„É°„É≠„Ç¶„ÉÜ„Ç£„Éº",
          items: "Mist",
          scent: "Êüî„Çâ„Åã„ÅèÂåÖ„ÅøËæº„ÇÄ„Ç≥„ÉÉ„Éà„É≥„ÅÆÈ¶ô„Çä",
          desc: "Ê¥ó„ÅÑÁ´ã„Å¶„ÅÆ„Ç∑„Éº„ÉÑ„Å´ÂåÖ„Åæ„Çå„Çã„Çà„ÅÜ„Å™Âπ∏Á¶èÊÑü„ÄÇÂøô„Åó„ÅÑÊó•Â∏∏„ÇíÈÅé„Åî„Åô„ÅÇ„ÅÆ‰∫∫„Å∏„ÄÅ„Éõ„ÉÉ„Å®‰∏ÄÊÅØ„Å§„Åë„ÇãÁû¨Èñì„Çí„ÄÇ",
          color: "bg-blue-100 text-blue-900",
          accent: "text-blue-500",
          tags: ["ÂÆâ„Çâ„Åé", "Ê∏ÖÊΩîÊÑü", "„É™„É©„ÉÉ„ÇØ„Çπ"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/NhFCBj5.png",
        },
        {
          id: "floral-sweet",
          name: "„Éï„É≠„Éº„É©„É´„Éª„Çπ„Ç§„Éº„Éà„ÉÜ„Ç£„Éº",
          items: "Lotion, Wash, Mist",
          scent: "Ëä±Êùü„ÅÆ„Çà„ÅÜ„Å™ËèØ„ÇÑ„Åã„Å™È¶ô„Çä",
          desc: "‰∏°Êâã„ÅÑ„Å£„Å±„ÅÑ„ÅÆËä±Êùü„Çí„ÇÇ„Çâ„Å£„ÅüÊôÇ„ÅÆ„Å®„Åç„ÇÅ„Åç„ÄÇ„ÅÑ„Å§„ÇÇÂë®„Çä„ÇíÊòé„Çã„Åè„Åó„Å¶„Åè„Çå„ÇãÊÑüË¨ù„ÇíËæº„ÇÅ„Å¶„ÄÇ",
          color: "bg-rose-100 text-rose-900",
          accent: "text-rose-500",
          tags: ["„Éè„ÉÉ„Éî„Éº", "ËèØ„ÇÑ„Åã", "ÊÑüË¨ù"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/4ZaANsL.png",
        },
        {
          id: "aqua-earl-grey",
          name: "„Ç¢„ÇØ„Ç¢„Éª„Ç¢„Éº„É´„Ç∞„É¨„Ç§„ÉÜ„Ç£„Éº",
          items: "250ml Lotion, facial scrub, body scrub",
          scent: "ÁàΩ„ÇÑ„Åã„ÅßÈÄèÊòéÊÑü„ÅÆ„ÅÇ„ÇãÁ¥ÖËå∂„ÅÆÈ¶ô„Çä",
          desc: "Ê£Æ„ÅÆ‰∏≠„ÇíÊï£Ê≠©„Åó„Å¶„ÅÑ„Çã„Çà„ÅÜ„Å™Ê∏Ö„ÄÖ„Åó„Åï„ÄÇ„É™„Éï„É¨„ÉÉ„Ç∑„É•„ÅåÂøÖË¶Å„Å™„ÅÇ„ÅÆ‰∫∫„Å´„ÄÅÂøÉÂú∞„Çà„ÅÑÈ¢®„ÇíÂ±ä„Åë„Åæ„Åó„Çá„ÅÜ„ÄÇ",
          color: "bg-teal-100 text-teal-900",
          accent: "text-teal-600",
          tags: ["ÁàΩ„ÇÑ„Åã", "‰ºëÊÅØ", "Ê£Æ„ÅÆÈ¶ô„Çä"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/6JLGgCw.png",
        },
        {
          id: "musk-rose",
          name: "„É†„Çπ„ÇØ„É≠„Éº„Ç∫„ÉÜ„Ç£„Éº",
          items: "250ml Lotion",
          scent: "ÂÑ™ÈõÖ„Åß„É≠„Éû„É≥„ÉÅ„ÉÉ„ÇØ„Å™„Éê„É©„ÅÆÈ¶ô„Çä",
          desc: "Êò†Áîª„ÅÆ„ÉØ„É≥„Ç∑„Éº„É≥„ÅÆ„Çà„ÅÜ„Å™„É≠„Éû„É≥„ÉÅ„ÉÉ„ÇØ„Å™„É†„Éº„Éâ„ÄÇÁâπÂà•„Å™Â§ú„ÄÅÁâπÂà•„Å™„ÅÇ„ÅÆ‰∫∫„Å∏Ë¥à„ÇãÊúÄÈ´ò„ÅÆ„Éê„É©„ÄÇ",
          color: "bg-red-50 text-red-900",
          accent: "text-red-400",
          tags: ["„É≠„Éû„É≥„ÉÅ„ÉÉ„ÇØ", "ÂÑ™ÈõÖ", "ÊÑõ"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/Gsp5aXh.png",
        },
        {
          id: "pear-green",
          name: "„Éö„Ç¢„Éª„Ç∞„É™„Éº„É≥„ÉÜ„Ç£„Éº",
          items: "250ml Lotion",
          scent: "„Éï„É¨„ÉÉ„Ç∑„É•„ÅßÁëû„ÄÖ„Åó„ÅÑÊ¥ãÊ¢®„ÅÆÈ¶ô„Çä",
          desc: "„ÇÇ„Åé„Åü„Å¶„ÅÆÊûúÂÆü„ÅÆ„Çà„ÅÜ„Å™„Éï„É¨„ÉÉ„Ç∑„É•„ÅïÔºÅÂÖÉÊ∞ó„ÅÑ„Å£„Å±„ÅÑ„Åß„Ç®„Éç„É´„ÇÆ„ÉÉ„Ç∑„É•„Å™„ÅÇ„ÅÆ‰∫∫„Å´„Å¥„Å£„Åü„Çä„Åß„Åô„ÄÇ",
          color: "bg-green-100 text-green-900",
          accent: "text-green-600",
          tags: ["„Éï„É¨„ÉÉ„Ç∑„É•", "ÁàΩÂø´", "„Ç®„Éä„Ç∏„Éº"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/B6TtVzw.png",
        },
      ];

      const QUESTIONS = [
        {
          id: 1,
          text: "‰ªäÂπ¥„ÅÆ„ÇØ„É™„Çπ„Éû„Çπ„ÄÅ\nË™∞„Å´„Éè„ÉÉ„Éî„Éº„ÇíÂ±ä„Åë„Åü„ÅÑÔºü",
          options: [
            { text: "Â§ßÂ•Ω„Åç„Å™ÊÅã‰∫∫„Éª„Éë„Éº„Éà„Éä„Éº", value: "lover" },
            { text: "Â§ßÂàá„Å™ÂÆ∂Êóè", value: "family" },
            { text: "‰ª≤ËâØ„Åó„ÅÆÂèãÈÅî„ÉªÂêåÂÉö", value: "friend" },
            { text: "È†ëÂºµ„Å£„ÅüËá™ÂàÜËá™Ë∫´", value: "me" },
          ],
        },
        {
          id: 2,
          text: "„Åù„ÅÆ‰∫∫„ÅÆ„Ç§„É°„Éº„Ç∏„Ç´„É©„Éº„ÅØÔºü",
          options: [
            { text: "„Åµ„Çì„Çè„ÇäÊ∏©„Åã„ÅÑ„Éë„Çπ„ÉÜ„É´„Ç´„É©„Éº", value: "warm" },
            { text: "Ê¥óÁ∑¥„Åï„Çå„Åü„Ç∑„ÉÉ„ÇØ„Å™„É¢„Éé„Éà„Éº„É≥", value: "chic" },
            { text: "Êòé„Çã„ÅèÂÖÉÊ∞ó„Å™„Éì„Éì„ÉÉ„Éâ„Ç´„É©„Éº", value: "bright" },
            { text: "Ê∏ÖÊΩîÊÑü„ÅÆ„ÅÇ„Çã„Éõ„ÉØ„Ç§„Éà„Éª„Éñ„É´„Éº", value: "clean" },
          ],
        },
        {
          id: 3,
          text: "„Åù„ÅÆ‰∫∫„Å®ÂÜ¨„ÅÆÊóÖË°å„Å´Ë°å„Åè„Å™„ÇâÔºü",
          options: [
            { text: "Èùô„Åã„Å™Ê£Æ„ÅÆ„Ç≥„ÉÜ„Éº„Ç∏", value: "nature" },
            { text: "„Åç„Çâ„ÇÅ„ÅèÈÉΩ‰ºö„ÅÆ„Ç§„É´„Éü„Éç„Éº„Ç∑„Éß„É≥", value: "city" },
            { text: "ÂçóÂõΩ„É™„Çæ„Éº„Éà„Åß„Åæ„Å£„Åü„Çä", value: "resort" },
            { text: "Ê∏©Ê≥â„Åß„Åª„Å£„Åì„Çä", value: "history" },
          ],
        },
        {
          id: 4,
          text: "ÂØí„ÅÑÊó•„Å´‰∏ÄÁ∑í„Å´È£≤„Åø„Åü„ÅÑ„ÅÆ„ÅØÔºü",
          options: [
            { text: "ÁîòÔΩû„ÅÑ„Éõ„ÉÉ„Éà„ÉÅ„Éß„Ç≥", value: "sweet" },
            { text: "È¶ô„ÇäÈ´ò„ÅÑÁ¥ÖËå∂", value: "tea" },
            { text: "Ê∑±„Åø„ÅÆ„ÅÇ„Çã„Ç≥„Éº„Éí„Éº", value: "coffee" },
            { text: "ÁàΩ„ÇÑ„Åã„Å™ÊüöÂ≠êËå∂", value: "fresh" },
          ],
        },
        {
          id: 5,
          text: "„Åù„ÅÆ‰∫∫„ÅÆÊÄßÊ†º„ÅØÔºü",
          options: [
            { text: "Á©è„ÇÑ„Åã„ÅßÂÑ™„Åó„ÅÑ", value: "calm" },
            { text: "ÊÉÖÁÜ±ÁöÑ„Åß„Ç¢„ÇØ„ÉÜ„Ç£„Éñ", value: "passion" },
            { text: "ÁπäÁ¥∞„Åß„Çª„É≥„ÇπÊäúÁæ§", value: "sensitive" },
            { text: "Êòé„Çã„ÅÑ„É†„Éº„Éâ„É°„Éº„Ç´„Éº", value: "funny" },
          ],
        },
        {
          id: 6,
          text: "„Éë„Éº„ÉÜ„Ç£„Éº„ÅßÊµÅ„Åô„Å™„ÇâÔºü",
          options: [
            { text: "„Åä„Åó„ÇÉ„Çå„Å™„Ç∏„É£„Ç∫", value: "jazz" },
            { text: "Âé≥„Åã„Å™„ÇØ„É©„Ç∑„ÉÉ„ÇØ", value: "classic" },
            { text: "Ê•Ω„Åó„ÅÑ„ÇØ„É™„Çπ„Éû„Çπ„ÇΩ„É≥„Ç∞", value: "pop" },
            { text: "ËêΩ„Å°ÁùÄ„Åè„Ç¢„Ç≥„Éº„Çπ„ÉÜ„Ç£„ÉÉ„ÇØ", value: "acoustic" },
          ],
        },
        {
          id: 7,
          text: "„Éó„É¨„Çº„É≥„Éà„Åó„Åü„ÅÑ\n„Ç∑„ÉÅ„É•„Ç®„Éº„Ç∑„Éß„É≥„ÅØÔºü",
          options: [
            { text: "Èõ™Èôç„ÇãÁ™ìËæ∫„Åß„ÅÆÈùô„Åã„Å™ÊôÇÈñì", value: "lily-musk" },
            { text: "ÊöñÁÇâ„ÅÆÂâç„ÅßË™û„ÇäÂêà„ÅÜÊôÇÈñì", value: "sage-amber" },
            { text: "„Ç±„Éº„Ç≠„ÇíÂõ≤„ÇÄÊ•Ω„Åó„ÅÑÊôÇÈñì", value: "fig-peach" },
            { text: "Ëä±„Å´Âõ≤„Åæ„Çå„ÅüÂÑ™ÈõÖ„Å™„ÉÜ„Ç£„Éº„Çø„Ç§„É†", value: "floral-sweet" },
            { text: "Ê¥ó„ÅÑÁ´ã„Å¶„ÅÆ„Ç∑„Éº„ÉÑ„Å´ÂåÖ„Åæ„Çå„ÇãÊúù", value: "blue-mellow" },
            { text: "ÊæÑ„Çì„Å†Á©∫Ê∞ó„ÅÆÊ£Æ„ÇíÊï£Ê≠©", value: "aqua-earl-grey" },
          ],
        },
      ];

      const QUESTION_ICONS = ["üéÅ", "‚ú®", "üìç", "‚òïÔ∏è", "üòä", "üéß", "‚≠êÔ∏è"];

      function App() {
        const [step, setStep] = useState("intro");
        const [purchaseNumber, setPurchaseNumber] = useState("");
        const [answers, setAnswers] = useState({});
        const [currentQIdx, setCurrentQIdx] = useState(0);
        const [recommendedProduct, setRecommendedProduct] = useState(null);
        const [finalChoice, setFinalChoice] = useState(null);
        const [formData, setFormData] = useState({
          story: "",
          preferredItem: "",
        });
        const [isSubmitting, setIsSubmitting] = useState(false);

        const clickSoundRef = useRef(null);

        const playClickSound = () => {
          if (clickSoundRef.current) {
            clickSoundRef.current.currentTime = 0;
            clickSoundRef.current
              .play()
              .catch((error) => console.log("Audio play failed:", error));
          }
        };

        useEffect(() => {
          window.scrollTo(0, 0);
        }, [step]);

        const resetApp = () => {
          playClickSound();
          setStep("intro");
          setPurchaseNumber("");
          setAnswers({});
          setCurrentQIdx(0);
          setRecommendedProduct(null);
          setFinalChoice(null);
          setFormData({ story: "", preferredItem: "" });
          setIsSubmitting(false);
        };

        const snowflakes = useMemo(
          () =>
            Array.from({ length: 30 }).map((_, i) => ({
              id: i,
              left: `${Math.random() * 100}%`,
              animationDuration: `${Math.random() * 5 + 5}s`,
              opacity: Math.random() * 0.7 + 0.3,
              size: Math.random() * 15 + 10,
            })),
          []
        );

        const handlePurchaseSubmit = (e) => {
          e.preventDefault();
          playClickSound();
          if (purchaseNumber.length < 5) {
            const input = document.getElementById("purchase-input");
            if (input) {
              input.style.borderColor = "red";
              setTimeout(
                () => (input.style.borderColor = "rgba(232, 198, 96, 0.4)"),
                1000
              );
            }
            return;
          }
          setStep("quiz");
        };

        const handleAnswer = (value) => {
          playClickSound();
          const newAnswers = { ...answers, [currentQIdx]: value };
          setAnswers(newAnswers);

          if (currentQIdx < QUESTIONS.length - 1) {
            setCurrentQIdx(currentQIdx + 1);
          } else {
            setStep("loading");
            calculateResult(newAnswers);
          }
        };

        const calculateResult = (finalAnswers) => {
          const key = finalAnswers[6]; // ÎßàÏßÄÎßâ ÏßàÎ¨∏(ÏãúÏ∏ÑÏóêÏù¥ÏÖò)
          let product = PRODUCTS.find((p) => p.id === key);

          if (!product) {
            const mood = finalAnswers[1];
            if (mood === "warm") product = PRODUCTS.find((p) => p.id === "musk-rose");
            else if (mood === "bright")
              product = PRODUCTS.find((p) => p.id === "pear-green");
            else product = PRODUCTS[0];
          }

          setTimeout(() => {
            setRecommendedProduct(product);
            setFinalChoice(product);
            setStep("result");
          }, 2500);
        };

        const handleFinalSubmit = async (e) => {
          e.preventDefault();
          playClickSound();
          setIsSubmitting(true);

          const giftString = `${finalChoice.name} (${
            formData.preferredItem || "Random"
          })`;

          if (GOOGLE_SCRIPT_URL) {
            try {
              await fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  purchaseNumber: purchaseNumber,
                  gift: giftString,
                  story: formData.story,
                }),
              });
            } catch (error) {
              console.error("Error submitting to Google Sheets:", error);
            }
          }

          setTimeout(() => {
            setIsSubmitting(false);
            setStep("success");
          }, 1500);
        };

        return (
          <div className="min-h-screen text-white font-sans relative bg-[#0f281e] overflow-x-hidden flex flex-col">
            <audio
              ref={clickSoundRef}
              src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"
              preload="auto"
            />

            {/* Îàà ÎÇ¥Î¶¨Îäî Î∞∞Í≤Ω */}
            <div className="fixed inset-0 pointer-events-none z-0">
              {snowflakes.map((flake) => (
                <div
                  key={flake.id}
                  className="absolute text-white/40"
                  style={{
                    left: flake.left,
                    top: "-20px",
                    animation: `fall ${flake.animationDuration} linear infinite`,
                    opacity: flake.opacity,
                    fontSize: `${flake.size}px`,
                  }}
                >
                  ‚ùÑ
                </div>
              ))}
            </div>

            {/* Î°úÍ≥† */}
            <div className="relative z-20 w-full text-center pt-8 pb-4 flex-none">
              <h1 className="text-4xl font-dancing font-bold tracking-widest text-[#e8c660] drop-shadow-md">
                TEABLESS
              </h1>
              <div className="flex justify-center items-center gap-2 text-xs text-[#e8c660]/90 mt-1 font-mincho font-bold tracking-widest">
                <span>‚òÖ</span>
                <span>„ÉÜ„Ç£„Éº„Éñ„É¨„Çπ</span>
                <span>‚òÖ</span>
              </div>
            </div>

            <main className="relative z-10 w-full max-w-md mx-auto flex-1 flex flex-col items-center justify-center p-6 pb-12">
              {/* INTRO */}
              {step === "intro" && (
                <div className="text-center space-y-6 animate-fade-in w-full flex flex-col items-center flex-1 justify-center">
                  <div className="relative py-4 flex flex-col items-center">
                    <div className="relative mb-6 w-56 h-56 flex items-center justify-center">
                      <div className="absolute inset-0 bg-[#d63031]/30 blur-[60px] rounded-full animate-pulse"></div>
                      <div className="absolute inset-0 bg-[#e8c660]/10 blur-[40px] rounded-full mix-blend-screen"></div>

                      <img
                        src="https://i.imgur.com/gfbvDNB.png"
                        alt="Santa Teabless"
                        className="relative z-10 w-full h-full object-contain drop-shadow-2xl"
                        style={{
                          animation: "float 4s ease-in-out infinite",
                          maskImage:
                            "linear-gradient(to bottom, black 60%, transparent 100%)",
                          WebkitMaskImage:
                            "linear-gradient(to bottom, black 60%, transparent 100%)",
                        }}
                      />

                      <div className="absolute inset-0 z-20 pointer-events-none">
                        <div className="absolute top-[20%] right-[20%] text-[#e8c660] animate-pulse opacity-80 text-sm">
                          ‚ú®
                        </div>
                        <div className="absolute top-[10%] left-[30%] text-white opacity-60 text-xs">
                          ‚òÖ
                        </div>
                      </div>
                    </div>

                    <div className="relative z-10 flex flex-col items-center -mt-6 w-full">
                      <h2 className="text-3xl font-extrabold leading-tight text-white drop-shadow-xl flex items-center justify-center gap-2 whitespace-nowrap">
                        <span className="text-[#d63031] font-chewy text-4xl transform -rotate-6 pt-1">
                          Santa
                        </span>
                        <span>„Å´„Å™„Çç„ÅÜÔºÅ</span>
                      </h2>
                    </div>
                  </div>

                  <div className="bg-white/5 backdrop-blur-md p-6 rounded-2xl border border-white/10 shadow-lg w-full max-w-xs mx-auto">
                    <p className="text-white/90 text-sm leading-7 text-pretty font-medium break-keep">
                      Â§ßÂàá„Å™„ÅÇ„ÅÆ‰∫∫„ÇíÊÄù„ÅÑÊµÆ„Åã„Åπ„Å™„Åå„Çâ„ÄÅ<br />
                      „Åù„ÅÆ‰∫∫„Å´„Å¥„Å£„Åü„Çä„ÅÆ„ÇÆ„Éï„Éà„Çí
                      <br />
                      ÈÅ∏„Çì„Åß„Åø„Åæ„Åõ„Çì„ÅãÔºü<br />
                      <br />
                      „ÉÜ„Ç£„Éº„Éñ„É¨„Çπ„Åå„ÅÇ„Å™„Åü„ÅÆ
                      <br />
                      Ê∏©„Åã„ÅÑÊ∞óÊåÅ„Å°„Çí„ÅäÂ±ä„Åë„Åó„Åæ„Åô„ÄÇ
                    </p>
                  </div>

                  <button
                    onClick={() => {
                      playClickSound();
                      setStep("input");
                    }}
                    className="w-full max-w-xs group bg-[#d63031] hover:bg-[#ff7675] text-white px-8 py-4 rounded-2xl font-bold transition-all flex items-center justify-center gap-2 shadow-lg shadow-red-900/40 transform hover:-translate-y-1 mt-4"
                  >
                    „ÇÆ„Éï„ÉàÈÅ∏„Å≥„ÇíÂßã„ÇÅ„Çã
                    <span className="group-hover:translate-x-1 transition-transform">
                      ‚ûú
                    </span>
                  </button>
                </div>
              )}

              {/* INPUT */}
              {step === "input" && (
                <div className="w-full max-w-xs space-y-8 text-center animate-fade-in flex-1 flex flex-col justify-center">
                  <div className="space-y-3">
                    <h3 className="text-2xl font-bold text-[#e8c660] drop-shadow-md">
                      Ë≥ºÂÖ•Ë™çË®º
                    </h3>
                    <p className="text-sm text-white/80 leading-relaxed text-pretty">
                      Ê≥®ÊñáÂ±•Ê≠¥„Å´„ÅÇ„Çã
                      <br />
                      <span className="bg-white/10 px-2 py-0.5 rounded text-[#e8c660] font-bold">
                        Ë≥ºÂÖ•Áï™Âè∑
                      </span>
                      „ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ
                    </p>
                  </div>

                  <form onSubmit={handlePurchaseSubmit} className="space-y-4">
                    <div className="relative">
                      <input
                        id="purchase-input"
                        type="text"
                        placeholder="‰æã) 20251225"
                        className="w-full bg-white/5 border border-[#e8c660]/40 rounded-2xl px-4 py-4 text-center text-white placeholder-white/30 focus:outline-none focus:border-[#e8c660] focus:bg-white/10 transition-all backdrop-blur-sm text-lg tracking-wider"
                        value={purchaseNumber}
                        onChange={(e) => setPurchaseNumber(e.target.value)}
                      />
                    </div>
                    <button
                      type="submit"
                      className="w-full bg-[#1a4c3a] active:bg-[#e8c660] active:text-[#1a2e25] border border-[#e8c660]/50 text-[#e8c660] py-4 rounded-2xl transition-all font-bold shadow-lg"
                    >
                      Á¢∫Ë™ç„Åô„Çã
                    </button>
                  </form>
                </div>
              )}

              {/* QUIZ */}
              {step === "quiz" && (
                <div
                  key={currentQIdx}
                  className="w-full max-w-sm space-y-6 animate-fade-in flex flex-col flex-1 justify-center py-4"
                >
                  <div className="w-full bg-white/10 h-1.5 rounded-full mb-2 overflow-hidden shrink-0">
                    <div
                      className="bg-[#e8c660] h-full transition-all duration-500 ease-out"
                      style={{
                        width: `${
                          ((currentQIdx + 1) / QUESTIONS.length) * 100
                        }%`,
                      }}
                    ></div>
                  </div>

                  <div className="flex justify-center mb-1 shrink-0">
                    <div className="bg-white/10 p-4 rounded-full backdrop-blur-md shadow-inner border border-white/5 text-2xl">
                      {QUESTION_ICONS[currentQIdx]}
                    </div>
                  </div>

                  <h3 className="text-xl font-bold text-center leading-relaxed text-pretty min-h-[4rem] flex items-center justify-center drop-shadow-md px-2 break-keep shrink-0 whitespace-pre-line">
                    {QUESTIONS[currentQIdx].text}
                  </h3>

                  <div className="grid grid-cols-1 gap-3 pt-2 w-full">
                    {QUESTIONS[currentQIdx].options.map((opt, idx) => (
                      <button
                        key={idx}
                        onClick={() => handleAnswer(opt.value)}
                        className="w-full bg-white/5 active:bg-[#e8c660] active:text-[#1a2e25] active:scale-95 border border-white/10 p-4 rounded-2xl text-left transition-all flex items-center justify-between group backdrop-blur-sm shadow-sm"
                      >
                        <span className="font-medium">{opt.text}</span>
                        <span className="opacity-0 group-active:opacity-100 group-hover:opacity-100 transition-all transform group-active:translate-x-1 group-hover:translate-x-1">
                          ‚ûú
                        </span>
                      </button>
                    ))}
                  </div>

                  <div className="text-center text-xs text-white/30 mt-2 font-bold shrink-0">
                    {currentQIdx + 1} / {QUESTIONS.length}
                  </div>
                </div>
              )}

              {/* LOADING */}
              {step === "loading" && (
                <div className="text-center space-y-6 animate-pulse px-6 flex-1 flex flex-col justify-center items-center">
                  <div className="relative inline-block">
                    <div className="absolute inset-0 bg-[#e8c660] blur-2xl opacity-20 rounded-full animate-pulse"></div>
                    <div className="text-5xl relative z-10">‚ú®</div>
                  </div>
                  <p className="text-xl font-bold text-white leading-relaxed text-pretty">
                    Â§ßÂàá„Å™„ÅÇ„ÅÆ‰∫∫„Å´„Å¥„Å£„Åü„Çä„ÅÆ
                    <br />
                    È¶ô„Çä„Çí„É©„ÉÉ„Éî„É≥„Ç∞‰∏≠...
                  </p>
                </div>
              )}

              {/* RESULT */}
              {step === "result" && finalChoice && (
                <div className="w-full max-w-sm animate-fade-in pt-4 pb-20">
                  <div className="text-center mb-6">
                    <span className="bg-[#d63031] text-white px-4 py-1.5 rounded-full text-xs font-bold tracking-wider mb-4 inline-block shadow-md border border-white/10">
                      SANTA'S PICK
                    </span>
                    <h3 className="text-2xl font-extrabold drop-shadow-md leading-relaxed text-pretty">
                      <span className="text-[#e8c660] border-b-2 border-[#e8c660]/50 pb-1 px-1 inline-block">
                        {
                          QUESTIONS[0].options.find(
                            (o) => o.value === answers[0]
                          )?.text || "Â§ßÂàá„Å™‰∫∫"
                        }
                      </span>
                      „Å∏„ÅÆ
                      <br />
                      „Éó„É¨„Çº„É≥„Éà
                    </h3>
                  </div>

                  <div className="bg-white/95 backdrop-blur-xl rounded-3xl p-6 text-slate-800 shadow-2xl relative overflow-hidden mb-6 transition-all group border-4 border-white/20">
                    <a
                      href={finalChoice.link}
                      target="_blank"
                      rel="noreferrer"
                      className="block relative cursor-pointer group-hover:scale-[1.02] transition-transform duration-300"
                    >
                      <div className="w-full aspect-square bg-slate-100 rounded-2xl mb-5 flex flex-col items-center justify-center text-slate-300 relative overflow-hidden border border-slate-200">
                        <img
                          src={finalChoice.image}
                          alt={finalChoice.name}
                          className="w-full h-full object-cover"
                          onError={(e) => {
                            e.target.onerror = null;
                            e.target.src =
                              "https://placehold.co/400x400/e2e8f0/64748b?text=Teabless";
                          }}
                        />
                        <div className="absolute bottom-2 right-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded-full flex items-center gap-1 backdrop-blur-sm">
                          üîó <span>Ë©≥Á¥∞„ÅØ„Ç≥„ÉÅ„É©</span>
                        </div>
                      </div>
                    </a>

                    <div className="relative z-10">
                      <div className="flex justify-between items-start mb-2">
                        <h4
                          className={`text-xs font-bold uppercase tracking-wider py-1 px-2 rounded-md ${finalChoice.color} ${finalChoice.accent}`}
                        >
                          Best Match
                        </h4>
                      </div>

                      <h2 className="text-xl font-extrabold mb-1 leading-tight text-slate-900 text-pretty break-words">
                        {finalChoice.name}
                      </h2>
                      <p className="text-xs text-slate-500 mb-4 font-bold">
                        {finalChoice.items}
                      </p>

                      <div className="flex gap-1.5 mb-5 flex-wrap">
                        {finalChoice.tags.map((tag) => (
                          <span
                            key={tag}
                            className="text-[11px] bg-slate-100 border border-slate-200 text-slate-600 px-2.5 py-1 rounded-full font-bold"
                          >
                            #{tag}
                          </span>
                        ))}
                      </div>

                      <div className="bg-[#f8f9fa] p-4 rounded-2xl border border-slate-100 mb-4 w-full">
                        <p className="text-sm text-slate-700 leading-relaxed font-medium text-pretty break-words whitespace-normal">
                          "{finalChoice.desc}"
                        </p>
                      </div>

                      <div className="flex items-center gap-3">
                        <div className="w-8 h-8 rounded-full bg-[#e8c660]/20 flex items-center justify-center shrink-0">
                          ‚ú®
                        </div>
                        <div className="flex-1 min-w-0">
                          <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-0.5">
                            Scent Note
                          </p>
                          <p className="text-sm font-bold text-slate-800 text-pretty break-words leading-tight">
                            {finalChoice.scent}
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>

                  <div className="bg-[#1a4c3a]/80 backdrop-blur-md rounded-2xl p-5 border border-[#e8c660]/20 mb-8 shadow-lg">
                    <div className="flex items-center gap-2 mb-4">
                      <span>üîÅ</span>
                      <h4 className="text-white font-bold text-sm">
                        ‰ªñ„ÅÆÈ¶ô„Çä„Å´Â§âÊõ¥„Åó„Åæ„Åô„ÅãÔºü
                      </h4>
                    </div>

                    <div className="space-y-2 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                      {PRODUCTS.map((prod) => (
                        <button
                          key={prod.id}
                          onClick={() => {
                            playClickSound();
                            setFinalChoice(prod);
                          }}
                          className={`w-full p-3 rounded-xl text-left text-sm transition-all border flex items-center justify-between
                      ${
                        finalChoice.id === prod.id
                          ? "bg-[#e8c660] border-[#e8c660] text-[#1a2e25] font-extrabold shadow-md transform scale-[1.02]"
                          : "bg-white/5 border-white/5 text-white/70 active:bg-white/10"
                      }`}
                        >
                          <div className="flex flex-col items-start gap-1 w-[85%]">
                            <span
                              className={`text-[10px] uppercase tracking-wider w-full ${
                                finalChoice.id === prod.id
                                  ? "text-[#1a2e25]/80 font-bold"
                                  : "text-[#e8c660] opacity-90"
                              }`}
                            >
                              {prod.scent}
                            </span>
                            <span className="font-medium text-sm text-left leading-tight text-pretty break-words w-full">
                              {prod.name}
                            </span>
                          </div>
                          {finalChoice.id === prod.id && (
                            <span className="shrink-0">‚úîÔ∏è</span>
                          )}
                        </button>
                      ))}
                    </div>
                  </div>

                  <div className="mt-8 mb-4 sticky bottom-6 z-30">
                    <button
                      onClick={() => {
                        playClickSound();
                        setStep("form");
                      }}
                      className="w-full bg-[#d63031] text-white py-4 rounded-2xl font-bold text-lg active:bg-[#ff7675] active:scale-95 transition-all shadow-[0_0_25px_rgba(214,48,49,0.6)] flex items-center justify-center gap-2 border-2 border-white/10"
                    >
                      <span>üéÅ</span>
                      <span>„Åì„ÅÆ„ÇÆ„Éï„Éà„ÅßÁ¢∫ÂÆö„Åô„Çã</span>
                    </button>
                  </div>
                </div>
              )}

              {/* FORM */}
              {step === "form" && (
                <div className="w-full max-w-xs animate-fade-in pt-4 pb-12 flex-1 flex flex-col justify-center">
                  <div className="text-center mb-6 pt-2">
                    <div className="inline-block p-4 bg-white/10 rounded-full mb-4 backdrop-blur-md border border-white/10 text-3xl">
                      ‚úâÔ∏è
                    </div>
                    <h3 className="text-2xl font-extrabold drop-shadow-md">
                      „Ç®„Éî„ÇΩ„Éº„ÉâÂÖ•Âäõ
                    </h3>
                    <p className="text-sm text-white/80 mt-3 leading-relaxed text-pretty">
                      <span className="text-[#e8c660] font-bold">
                        "{finalChoice?.name}"
                      </span>
                      „É©„Ç§„É≥„Åã„Çâ
                      <br />
                      Ë¥à„Çä„Åü„ÅÑË£ΩÂìÅ„ÇíÈÅ∏„Çì„Åß„ÄÅ
                      <br />
                      „Åù„ÅÆÁêÜÁî±„ÇíÊïô„Åà„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ
                    </p>
                    <div className="mt-4 bg-[#d63031]/20 border border-[#d63031] text-[#ff7675] text-xs font-bold px-3 py-1 rounded-full inline-block animate-pulse">
                      üéÅ Êõ∏„ÅÑ„Å¶„ÅÑ„Åü„Å†„Åè„Å®ÂΩìÈÅ∏Á¢∫ÁéáUPÔºÅ
                    </div>
                  </div>

                  <form
                    onSubmit={handleFinalSubmit}
                    className="space-y-5 bg-white/5 p-6 rounded-3xl border border-white/10 backdrop-blur-md shadow-xl"
                  >
                    <div>
                      <label className="block text-xs font-bold text-[#e8c660] mb-2 ml-1 flex items-center gap-1">
                        ‚úèÔ∏è Â∏åÊúõ„Åô„ÇãË£ΩÂìÅ (‰ªªÊÑè)
                      </label>
                      <input
                        type="text"
                        placeholder="‰æãÔºö„É≠„Éº„Ç∑„Éß„É≥„ÄÅ„Ç¶„Ç©„ÉÉ„Ç∑„É•„Å™„Å©"
                        className="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#e8c660] focus:bg-black/30 focus:outline-none transition-colors text-sm"
                        value={formData.preferredItem}
                        onChange={(e) =>
                          setFormData({
                            ...formData,
                            preferredItem: e.target.value,
                          })
                        }
                      />
                      <p className="text-[10px] text-white/40 mt-1 ml-1">
                        ‚Äª „Åì„ÅÆÈ¶ô„Çä„ÅÆ„É©„Ç§„É≥„Éä„ÉÉ„Éó„Åã„ÇâÊ¨≤„Åó„ÅÑË£ΩÂìÅ„Åå„ÅÇ„Çå„Å∞Ë®òÂÖ•„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇÊú™ÂÖ•Âäõ„ÅÆÂ†¥Âêà„ÅØ„É©„É≥„ÉÄ„É†„Å´„Å™„Çä„Åæ„Åô„ÄÇ
                      </p>
                    </div>

                    <div>
                      <label className="block text-xs font-bold text-[#e8c660] mb-2 ml-1">
                        „Éó„É¨„Çº„É≥„Éà„ÇíË¥à„Çä„Åü„ÅÑÁêÜÁî±
                      </label>
                      <textarea
                        required
                        rows="6"
                        placeholder="‰æãÔºö„ÅÑ„Å§„ÇÇ„Åä‰∏ñË©±„Å´„Å™„Å£„Å¶„ÅÑ„ÇãÊØç„Å∏„ÄÅÂÜ¨„ÅÆÂØí„Åï„ÇíÂøò„Çå„Çã„Çà„ÅÜ„Å™Ê∏©„Åã„ÅÑÈ¶ô„Çä„ÇíË¥à„Çä„Åü„Åè„Å¶..."
                        className="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#e8c660] focus:bg-black/30 focus:outline-none resize-none transition-colors leading-relaxed"
                        value={formData.story}
                        onChange={(e) =>
                          setFormData({ ...formData, story: e.target.value })
                        }
                      />
                    </div>

                    <button
                      type="submit"
                      disabled={isSubmitting}
                      className="w-full mt-2 bg-[#e8c660] text-[#1a2e25] py-4 rounded-xl font-bold text-lg active:bg-white transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    >
                      {isSubmitting ? "ÈÄÅ‰ø°‰∏≠..." : "„Çµ„É≥„Çø„Å´ÂøúÂãü„Åô„Çã"}
                    </button>
                  </form>
                </div>
              )}

              {/* SUCCESS */}
              {step === "success" && (
                <div className="text-center animate-scale-in w-full max-w-sm flex-1 flex flex-col justify-center">
                  <div className="relative inline-block mb-8">
                    <div className="absolute inset-0 bg-[#e8c660] blur-2xl opacity-20 rounded-full animate-pulse"></div>
                    <div className="relative z-10 flex items-center justify-center text-6xl">
                      ‚úÖ
                    </div>
                  </div>

                  <h2 className="text-3xl font-extrabold text-[#e8c660] mb-4 drop-shadow-md">
                    Áî≥Ë´ãÂÆå‰∫Ü!
                  </h2>
                  <p className="text-white/90 leading-relaxed mb-10 text-base font-medium text-pretty">
                    „Ç§„Éô„É≥„Éà„Å´„ÅîÂèÇÂä†„ÅÑ„Åü„Å†„Åç
                    <br />
                    „ÅÇ„Çä„Åå„Å®„ÅÜ„Åî„Åñ„ÅÑ„Åæ„Åô„ÄÇ
                    <br />
                    <br />
                    „ÅÇ„Å™„Åü„ÅÆÊ∏©„Åã„ÅÑ„Ç®„Éî„ÇΩ„Éº„Éâ„Åå
                    <br />
                    „Åç„Å£„Å®„ÇØ„É™„Çπ„Éû„Çπ„ÅÆÂ•áË∑°„Çí
                    <br />
                    Ëµ∑„Åì„Åô„Åß„Åó„Çá„ÅÜ„ÄÇ
                  </p>

                  <div className="bg-white/10 p-6 rounded-2xl border border-white/10 mb-10 text-sm text-left backdrop-blur-md shadow-lg relative overflow-hidden">
                    <div className="absolute top-0 right-0 p-2 opacity-10 text-6xl">
                      üéÅ
                    </div>
                    <p className="text-[#e8c660] text-xs font-bold mb-4 uppercase tracking-wider border-b border-white/10 pb-2">
                      Your Pick
                    </p>
                    <div className="space-y-3">
                      <div className="flex justify-between items-start border-b border-white/5 pb-2 mb-2">
                        <span className="text-white/60 font-medium mt-1 shrink-0">
                          Scent.
                        </span>
                        <span className="font-bold text-white text-right w-2/3 text-pretty">
                          {finalChoice?.name}
                        </span>
                      </div>
                      <div className="flex justify-between items-start">
                        <span className="text-white/60 font-medium mt-1 shrink-0">
                          Item.
                        </span>
                        <span className="font-bold text-[#e8c660] text-right w-2/3 text-pretty">
                          {formData.preferredItem || "„É©„É≥„ÉÄ„É†"}
                        </span>
                      </div>
                    </div>
                  </div>

                  <button
                    onClick={resetApp}
                    className="text-white/50 text-sm hover:text-white font-bold transition-colors flex items-center justify-center gap-2 mx-auto pb-4"
                  >
                    üîÅ ÊúÄÂàù„Å´Êàª„Çã
                  </button>
                </div>
              )}
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
