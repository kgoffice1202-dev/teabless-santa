<!doctype html>
<html lang="ja">
  <head>
    <meta charset="UTF-8" />
    <title>Teabless Christmas Gift Quiz</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <script src="https://cdn.tailwindcss.com"></script>

    <script src="https://unpkg.com/react@18/umd/react.development.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link
      href="https://fonts.googleapis.com/css2?family=M+PLUS+Rounded+1c:wght@400;500;700;800&family=Dancing+Script:wght@700&family=Chewy&family=Zen+Old+Mincho:wght@700&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "M PLUS Rounded 1c", sans-serif;
        background-color: #0f281e;
        margin: 0;
      }
      .font-dancing {
        font-family: "Dancing Script", cursive;
      }
      .font-chewy {
        font-family: "Chewy", cursive;
      }
      .font-mincho {
        font-family: "Zen Old Mincho", serif;
      }
      .text-pretty {
        text-wrap: pretty;
        word-break: break-word;
        overflow-wrap: break-word;
      }
      @keyframes fall {
        0% {
          transform: translateY(-20px) rotate(0deg);
        }
        100% {
          transform: translateY(100vh) rotate(360deg);
        }
      }
      @keyframes float {
        0%,
        100% {
          transform: translateY(0px);
        }
        50% {
          transform: translateY(-20px);
        }
      }
      .custom-scrollbar::-webkit-scrollbar {
        width: 4px;
      }
      .custom-scrollbar::-webkit-scrollbar-track {
        background: rgba(255, 255, 255, 0.05);
      }
      .custom-scrollbar::-webkit-scrollbar-thumb {
        background: rgba(232, 198, 96, 0.3);
        border-radius: 4px;
      }
      .no-scrollbar::-webkit-scrollbar {
        display: none;
      }
      .no-scrollbar {
        -ms-overflow-style: none;
        scrollbar-width: none;
      }
      .animate-fade-in {
        animation: fadeIn 0.8s ease-out forwards;
      }
      .animate-scale-in {
        animation: scaleIn 0.5s ease-out forwards;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
          transform: translateY(10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }
      @keyframes scaleIn {
        from {
          opacity: 0;
          transform: scale(0.9);
        }
        to {
          opacity: 1;
          transform: scale(1);
        }
      }
    </style>
  </head>

  <body class="bg-[#0f281e]">
    <div id="root"></div>

    <script type="text/babel">
      const { useState, useEffect, useRef, useMemo } = React;

      // êµ¬ê¸€ ì•±ìŠ¤ ìŠ¤í¬ë¦½íŠ¸ ë°°í¬ URL
      const GOOGLE_SCRIPT_URL =
        "https://script.google.com/macros/s/AKfycbyW41Fm06OccosiVx4p9ud5XQDOZpdonW9cpUpSWQw2bmHt-0dHKTCOmtDNIOUBRx08Xw/exec";

      // í†µí•© êµ¬ë§¤ ë§í¬
      const SHOP_LINK = "https://www.qoo10.jp/shop/teabless_official";

      // ì œí’ˆ ë°ì´í„°
      const PRODUCTS = [
        {
          id: "lily-musk",
          name: "ãƒªãƒªãƒ¼ãƒ ã‚¹ã‚¯ãƒ»ãƒ›ãƒ¯ã‚¤ãƒˆãƒ†ã‚£ãƒ¼",
          items: "Lotion, Wash, Hand Cream",
          scent: "ç´”ç²‹ã§æ¸©ã‹ã¿ã®ã‚ã‚‹ãƒ ã‚¹ã‚¯ã®é¦™ã‚Š",
          desc: "ã¾ã‚‹ã§é›ªãŒé™ã‚Šç©ã‚‚ã£ãŸåº­åœ’ã®ã‚ˆã†ãªç´”ç²‹ã•ã€‚æ¸…æ½”æ„Ÿã‚ãµã‚Œã‚‹ã‚ã®äººã«ã€å†¬ã®æœã®ã‚ˆã†ãªæ¾„ã‚“ã é¦™ã‚Šã‚’è´ˆã‚Šã¾ã›ã‚“ã‹ï¼Ÿ",
          color: "bg-slate-100 text-slate-800",
          accent: "text-slate-500",
          tags: ["ãƒ”ãƒ¥ã‚¢", "ã¬ãã‚‚ã‚Š", "å†¬ã®æœ"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/tH2AjAm.png",
        },
        {
          id: "fig-peach",
          name: "ãƒ•ã‚£ã‚°ãƒ”ãƒ¼ãƒãƒ»ã‚¦ãƒ¼ãƒ­ãƒ³ãƒ†ã‚£ãƒ¼",
          items: "Lotion, Wash",
          scent: "ç”˜ãç”Ÿãç”Ÿãã¨ã—ãŸãƒ•ãƒ«ãƒ¼ãƒ„ã®é¦™ã‚Š",
          desc: "ã‚¯ãƒªã‚¹ãƒã‚¹ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã®ãƒ¯ã‚¯ãƒ¯ã‚¯æ„Ÿï¼æ„›ã‚‰ã—ãã¦ãƒãƒ£ãƒ¼ãƒŸãƒ³ã‚°ãªã‚ã®äººã«ã¯ã€ç”˜ã„ãƒ•ãƒ«ãƒ¼ãƒ„ã®é¦™ã‚ŠãŒã´ã£ãŸã‚Šã€‚",
          color: "bg-pink-100 text-pink-900",
          accent: "text-pink-500",
          tags: ["æ„›ã‚‰ã—ã•", "ã‚¹ã‚¤ãƒ¼ãƒˆ", "ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/4ZaANsL.png",
        },
        {
          id: "sage-amber",
          name: "ã‚»ãƒ¼ã‚¸ã‚¢ãƒ³ãƒãƒ¼ãƒ»ãƒ‘ãƒ¼ãƒ—ãƒ«ãƒ†ã‚£ãƒ¼",
          items: "Lotion, Wash",
          scent: "è½ã¡ç€ã„ãŸæ·±ã¿ã®ã‚ã‚‹ã‚¦ãƒƒãƒ‡ã‚£ãªé¦™ã‚Š",
          desc: "æš–ç‚‰ã®ãã°ã§ãã¤ã‚ãã‚ˆã†ãªå®‰å¿ƒæ„Ÿã€‚ã„ã¤ã‚‚è½ã¡ç€ã„ã¦ã„ã‚‹å¤§äººãªã‚ã®äººã¸ã€æ·±ã„ç™’ã—ã®æ™‚é–“ã‚’ã€‚",
          color: "bg-purple-100 text-purple-900",
          accent: "text-purple-600",
          tags: ["å„ªé›…", "ãƒŸã‚¹ãƒ†ãƒªã‚¢ã‚¹", "é™å¯‚"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/WdKvuXf.png",
        },
        {
          id: "blue-mellow",
          name: "ãƒ–ãƒ«ãƒ¼ãƒ¡ãƒ­ã‚¦ãƒ†ã‚£ãƒ¼",
          items: "Mist",
          scent: "æŸ”ã‚‰ã‹ãåŒ…ã¿è¾¼ã‚€ã‚³ãƒƒãƒˆãƒ³ã®é¦™ã‚Š",
          desc: "æ´—ã„ç«‹ã¦ã®ã‚·ãƒ¼ãƒ„ã«åŒ…ã¾ã‚Œã‚‹ã‚ˆã†ãªå¹¸ç¦æ„Ÿã€‚å¿™ã—ã„æ—¥å¸¸ã‚’éã”ã™ã‚ã®äººã¸ã€ãƒ›ãƒƒã¨ä¸€æ¯ã¤ã‘ã‚‹ç¬é–“ã‚’ã€‚",
          color: "bg-blue-100 text-blue-900",
          accent: "text-blue-500",
          tags: ["å®‰ã‚‰ã", "æ¸…æ½”æ„Ÿ", "ãƒªãƒ©ãƒƒã‚¯ã‚¹"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/NhFCBj5.png",
        },
        {
          id: "floral-sweet",
          name: "ãƒ•ãƒ­ãƒ¼ãƒ©ãƒ«ãƒ»ã‚¹ã‚¤ãƒ¼ãƒˆãƒ†ã‚£ãƒ¼",
          items: "Lotion, Wash, Mist",
          scent: "èŠ±æŸã®ã‚ˆã†ãªè¯ã‚„ã‹ãªé¦™ã‚Š",
          desc: "ä¸¡æ‰‹ã„ã£ã±ã„ã®èŠ±æŸã‚’ã‚‚ã‚‰ã£ãŸæ™‚ã®ã¨ãã‚ãã€‚ã„ã¤ã‚‚å‘¨ã‚Šã‚’æ˜ã‚‹ãã—ã¦ãã‚Œã‚‹æ„Ÿè¬ã‚’è¾¼ã‚ã¦ã€‚",
          color: "bg-rose-100 text-rose-900",
          accent: "text-rose-500",
          tags: ["ãƒãƒƒãƒ”ãƒ¼", "è¯ã‚„ã‹", "æ„Ÿè¬"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/4ZaANsL.png",
        },
        {
          id: "aqua-earl-grey",
          name: "ã‚¢ã‚¯ã‚¢ãƒ»ã‚¢ãƒ¼ãƒ«ã‚°ãƒ¬ã‚¤ãƒ†ã‚£ãƒ¼",
          items: "250ml Lotion, facial scrub, body scrub",
          scent: "çˆ½ã‚„ã‹ã§é€æ˜æ„Ÿã®ã‚ã‚‹ç´…èŒ¶ã®é¦™ã‚Š",
          desc: "æ£®ã®ä¸­ã‚’æ•£æ­©ã—ã¦ã„ã‚‹ã‚ˆã†ãªæ¸…ã€…ã—ã•ã€‚ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãŒå¿…è¦ãªã‚ã®äººã«ã€å¿ƒåœ°ã‚ˆã„é¢¨ã‚’å±Šã‘ã¾ã—ã‚‡ã†ã€‚",
          color: "bg-teal-100 text-teal-900",
          accent: "text-teal-600",
          tags: ["çˆ½ã‚„ã‹", "ä¼‘æ¯", "æ£®ã®é¦™ã‚Š"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/6JLGgCw.png",
        },
        {
          id: "musk-rose",
          name: "ãƒ ã‚¹ã‚¯ãƒ­ãƒ¼ã‚ºãƒ†ã‚£ãƒ¼",
          items: "250ml Lotion",
          scent: "å„ªé›…ã§ãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãªãƒãƒ©ã®é¦™ã‚Š",
          desc: "æ˜ ç”»ã®ãƒ¯ãƒ³ã‚·ãƒ¼ãƒ³ã®ã‚ˆã†ãªãƒ­ãƒãƒ³ãƒãƒƒã‚¯ãªãƒ ãƒ¼ãƒ‰ã€‚ç‰¹åˆ¥ãªå¤œã€ç‰¹åˆ¥ãªã‚ã®äººã¸è´ˆã‚‹æœ€é«˜ã®ãƒãƒ©ã€‚",
          color: "bg-red-50 text-red-900",
          accent: "text-red-400",
          tags: ["ãƒ­ãƒãƒ³ãƒãƒƒã‚¯", "å„ªé›…", "æ„›"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/Gsp5aXh.png",
        },
        {
          id: "pear-green",
          name: "ãƒšã‚¢ãƒ»ã‚°ãƒªãƒ¼ãƒ³ãƒ†ã‚£ãƒ¼",
          items: "250ml Lotion",
          scent: "ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã§ç‘ã€…ã—ã„æ´‹æ¢¨ã®é¦™ã‚Š",
          desc: "ã‚‚ããŸã¦ã®æœå®Ÿã®ã‚ˆã†ãªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ã•ï¼å…ƒæ°—ã„ã£ã±ã„ã§ã‚¨ãƒãƒ«ã‚®ãƒƒã‚·ãƒ¥ãªã‚ã®äººã«ã´ã£ãŸã‚Šã§ã™ã€‚",
          color: "bg-green-100 text-green-900",
          accent: "text-green-600",
          tags: ["ãƒ•ãƒ¬ãƒƒã‚·ãƒ¥", "çˆ½å¿«", "ã‚¨ãƒŠã‚¸ãƒ¼"],
          link: SHOP_LINK,
          image: "https://i.imgur.com/B6TtVzw.png",
        },
      ];

      const QUESTIONS = [
        {
          id: 1,
          text: "ä»Šå¹´ã®ã‚¯ãƒªã‚¹ãƒã‚¹ã€\nèª°ã«ãƒãƒƒãƒ”ãƒ¼ã‚’å±Šã‘ãŸã„ï¼Ÿ",
          options: [
            { text: "å¤§å¥½ããªæ‹äººãƒ»ãƒ‘ãƒ¼ãƒˆãƒŠãƒ¼", value: "lover" },
            { text: "å¤§åˆ‡ãªå®¶æ—", value: "family" },
            { text: "ä»²è‰¯ã—ã®å‹é”ãƒ»åŒåƒš", value: "friend" },
            { text: "é ‘å¼µã£ãŸè‡ªåˆ†è‡ªèº«", value: "me" },
          ],
        },
        {
          id: 2,
          text: "ãã®äººã®ã‚¤ãƒ¡ãƒ¼ã‚¸ã‚«ãƒ©ãƒ¼ã¯ï¼Ÿ",
          options: [
            { text: "ãµã‚“ã‚ã‚Šæ¸©ã‹ã„ãƒ‘ã‚¹ãƒ†ãƒ«ã‚«ãƒ©ãƒ¼", value: "warm" },
            { text: "æ´—ç·´ã•ã‚ŒãŸã‚·ãƒƒã‚¯ãªãƒ¢ãƒãƒˆãƒ¼ãƒ³", value: "chic" },
            { text: "æ˜ã‚‹ãå…ƒæ°—ãªãƒ“ãƒ“ãƒƒãƒ‰ã‚«ãƒ©ãƒ¼", value: "bright" },
            { text: "æ¸…æ½”æ„Ÿã®ã‚ã‚‹ãƒ›ãƒ¯ã‚¤ãƒˆãƒ»ãƒ–ãƒ«ãƒ¼", value: "clean" },
          ],
        },
        {
          id: 3,
          text: "ãã®äººã¨å†¬ã®æ—…è¡Œã«è¡Œããªã‚‰ï¼Ÿ",
          options: [
            { text: "é™ã‹ãªæ£®ã®ã‚³ãƒ†ãƒ¼ã‚¸", value: "nature" },
            { text: "ãã‚‰ã‚ãéƒ½ä¼šã®ã‚¤ãƒ«ãƒŸãƒãƒ¼ã‚·ãƒ§ãƒ³", value: "city" },
            { text: "å—å›½ãƒªã‚¾ãƒ¼ãƒˆã§ã¾ã£ãŸã‚Š", value: "resort" },
            { text: "æ¸©æ³‰ã§ã»ã£ã“ã‚Š", value: "history" },
          ],
        },
        {
          id: 4,
          text: "å¯’ã„æ—¥ã«ä¸€ç·’ã«é£²ã¿ãŸã„ã®ã¯ï¼Ÿ",
          options: [
            { text: "ç”˜ï½ã„ãƒ›ãƒƒãƒˆãƒãƒ§ã‚³", value: "sweet" },
            { text: "é¦™ã‚Šé«˜ã„ç´…èŒ¶", value: "tea" },
            { text: "æ·±ã¿ã®ã‚ã‚‹ã‚³ãƒ¼ãƒ’ãƒ¼", value: "coffee" },
            { text: "çˆ½ã‚„ã‹ãªæŸšå­èŒ¶", value: "fresh" },
          ],
        },
        {
          id: 5,
          text: "ãã®äººã®æ€§æ ¼ã¯ï¼Ÿ",
          options: [
            { text: "ç©ã‚„ã‹ã§å„ªã—ã„", value: "calm" },
            { text: "æƒ…ç†±çš„ã§ã‚¢ã‚¯ãƒ†ã‚£ãƒ–", value: "passion" },
            { text: "ç¹Šç´°ã§ã‚»ãƒ³ã‚¹æŠœç¾¤", value: "sensitive" },
            { text: "æ˜ã‚‹ã„ãƒ ãƒ¼ãƒ‰ãƒ¡ãƒ¼ã‚«ãƒ¼", value: "funny" },
          ],
        },
        {
          id: 6,
          text: "ãƒ‘ãƒ¼ãƒ†ã‚£ãƒ¼ã§æµã™ãªã‚‰ï¼Ÿ",
          options: [
            { text: "ãŠã—ã‚ƒã‚Œãªã‚¸ãƒ£ã‚º", value: "jazz" },
            { text: "å³ã‹ãªã‚¯ãƒ©ã‚·ãƒƒã‚¯", value: "classic" },
            { text: "æ¥½ã—ã„ã‚¯ãƒªã‚¹ãƒã‚¹ã‚½ãƒ³ã‚°", value: "pop" },
            { text: "è½ã¡ç€ãã‚¢ã‚³ãƒ¼ã‚¹ãƒ†ã‚£ãƒƒã‚¯", value: "acoustic" },
          ],
        },
        {
          id: 7,
          text: "ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã—ãŸã„\nã‚·ãƒãƒ¥ã‚¨ãƒ¼ã‚·ãƒ§ãƒ³ã¯ï¼Ÿ",
          options: [
            { text: "é›ªé™ã‚‹çª“è¾ºã§ã®é™ã‹ãªæ™‚é–“", value: "lily-musk" },
            { text: "æš–ç‚‰ã®å‰ã§èªã‚Šåˆã†æ™‚é–“", value: "sage-amber" },
            { text: "ã‚±ãƒ¼ã‚­ã‚’å›²ã‚€æ¥½ã—ã„æ™‚é–“", value: "fig-peach" },
            { text: "èŠ±ã«å›²ã¾ã‚ŒãŸå„ªé›…ãªãƒ†ã‚£ãƒ¼ã‚¿ã‚¤ãƒ ", value: "floral-sweet" },
            { text: "æ´—ã„ç«‹ã¦ã®ã‚·ãƒ¼ãƒ„ã«åŒ…ã¾ã‚Œã‚‹æœ", value: "blue-mellow" },
            { text: "æ¾„ã‚“ã ç©ºæ°—ã®æ£®ã‚’æ•£æ­©", value: "aqua-earl-grey" },
          ],
        },
      ];

      const QUESTION_ICONS = ["ğŸ", "âœ¨", "ğŸ“", "â˜•ï¸", "ğŸ˜Š", "ğŸ§", "â­ï¸"];

      function App() {
        const [step, setStep] = useState("intro");
        const [purchaseNumber, setPurchaseNumber] = useState("");
        const [email, setEmail] = useState("");
        const [answers, setAnswers] = useState({});
        const [currentQIdx, setCurrentQIdx] = useState(0);
        const [recommendedProduct, setRecommendedProduct] = useState(null);
        const [finalChoice, setFinalChoice] = useState(null);
        const [formData, setFormData] = useState({
          story: "",
          preferredItem: "",
        });
        const [isSubmitting, setIsSubmitting] = useState(false);
        const [isSharedView, setIsSharedView] = useState(false); // ê³µìœ ëœ ë§í¬ë¡œ ë“¤ì–´ì™”ëŠ”ì§€ ì—¬ë¶€

        const clickSoundRef = useRef(null);

        const playClickSound = () => {
          if (clickSoundRef.current) {
            clickSoundRef.current.currentTime = 0;
            clickSoundRef.current
              .play()
              .catch((error) => console.log("Audio play failed:", error));
          }
        };

        // URL íŒŒë¼ë¯¸í„° í™•ì¸ (ê³µìœ ëœ ë§í¬ì¸ì§€ ì²´í¬)
        useEffect(() => {
          const params = new URLSearchParams(window.location.search);
          const sharedResultId = params.get("share");

          if (sharedResultId) {
            const product = PRODUCTS.find((p) => p.id === sharedResultId);
            if (product) {
              setRecommendedProduct(product);
              setFinalChoice(product);
              setIsSharedView(true); // ê³µìœ  ëª¨ë“œ í™œì„±í™”
              setStep("result"); // ë°”ë¡œ ê²°ê³¼ í™”ë©´ìœ¼ë¡œ
            }
          }
        }, []);

        // LINE ê³µìœ  ê¸°ëŠ¥ (ìˆ˜ì •ë¨: URLì— ê²°ê³¼ ID í¬í•¨)
        const handleLineShare = () => {
          if (!finalChoice) return;
          
          // í˜„ì¬ URLì—ì„œ ê¸°ì¡´ íŒŒë¼ë¯¸í„° ì œê±°í•˜ê³  ê¹¨ë—í•œ base URL ê°€ì ¸ì˜¤ê¸°
          const baseUrl = window.location.href.split('?')[0];
          // ê²°ê³¼ IDë¥¼ íŒŒë¼ë¯¸í„°ë¡œ ë¶™ì„
          const shareUrl = `${baseUrl}?share=${finalChoice.id}`;
          
          const text = `ğŸ„TEABLESS Christmas EventğŸ„\n\nç§ã®ã‚µãƒ³ã‚¿ãƒ”ãƒƒã‚¯ã¯...\nâœ¨${finalChoice.name}âœ¨\n\nã‚ãªãŸã«ã´ã£ãŸã‚Šã®é¦™ã‚Šã¯ï¼Ÿ\nä»Šã™ãè¨ºæ–­ã—ã¦ã¿ã‚ˆã†ï¼ğŸ‘‡\n`;
          const lineUrl = `https://line.me/R/msg/text/?${encodeURIComponent(text + shareUrl)}`;
          window.open(lineUrl, '_blank');
        };

        useEffect(() => {
          window.scrollTo(0, 0);
        }, [step]);

        const resetApp = () => {
          playClickSound();
          
          // URL íŒŒë¼ë¯¸í„° ì œê±° (ê¹¨ë—í•˜ê²Œ í€´ì¦ˆ ì‹œì‘)
          const cleanUrl = window.location.href.split('?')[0];
          window.history.pushState({}, document.title, cleanUrl);

          setStep("intro");
          setPurchaseNumber("");
          setEmail("");
          setAnswers({});
          setCurrentQIdx(0);
          setRecommendedProduct(null);
          setFinalChoice(null);
          setFormData({ story: "", preferredItem: "" });
          setIsSubmitting(false);
          setIsSharedView(false); // ê³µìœ  ëª¨ë“œ í•´ì œ
        };

        const snowflakes = useMemo(
          () =>
            Array.from({ length: 30 }).map((_, i) => ({
              id: i,
              left: `${Math.random() * 100}%`,
              animationDuration: `${Math.random() * 5 + 5}s`,
              opacity: Math.random() * 0.7 + 0.3,
              size: Math.random() * 15 + 10,
            })),
          []
        );

        const handleAnswer = (value) => {
          playClickSound();
          const newAnswers = { ...answers, [currentQIdx]: value };
          setAnswers(newAnswers);

          if (currentQIdx < QUESTIONS.length - 1) {
            setCurrentQIdx(currentQIdx + 1);
          } else {
            setStep("loading");
            calculateResult(newAnswers);
          }
        };

        const calculateResult = (finalAnswers) => {
          const key = finalAnswers[6]; // ë§ˆì§€ë§‰ ì§ˆë¬¸(ì‹œì¸„ì—ì´ì…˜)
          let product = PRODUCTS.find((p) => p.id === key);

          if (!product) {
            const mood = finalAnswers[1];
            if (mood === "warm") product = PRODUCTS.find((p) => p.id === "musk-rose");
            else if (mood === "bright")
              product = PRODUCTS.find((p) => p.id === "pear-green");
            else product = PRODUCTS[0];
          }

          setTimeout(() => {
            setRecommendedProduct(product);
            setFinalChoice(product);
            setStep("result");
          }, 2500);
        };

        const handleFinalSubmit = async (e) => {
          e.preventDefault();
          playClickSound();

          const hasPurchaseNumber = purchaseNumber.length >= 5;
          const hasEmail = email.includes("@") && email.includes(".");

          if (!hasPurchaseNumber && !hasEmail) {
            const input = document.getElementById("purchase-input-final");
            if (input) {
              input.style.borderColor = "red";
              input.style.backgroundColor = "rgba(255, 0, 0, 0.1)";
              input.focus();
              setTimeout(() => {
                input.style.borderColor = "rgba(255, 255, 255, 0.1)";
                input.style.backgroundColor = "rgba(0, 0, 0, 0.2)";
              }, 1500);
            }
            return;
          }

          setIsSubmitting(true);

          const giftString = `${finalChoice.name} (${
            formData.preferredItem || "Random"
          })`;

          if (GOOGLE_SCRIPT_URL) {
            try {
              await fetch(GOOGLE_SCRIPT_URL, {
                method: "POST",
                mode: "no-cors",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({
                  purchaseNumber: purchaseNumber,
                  email: email,
                  gift: giftString,
                  story: formData.story,
                }),
              });
            } catch (error) {
              console.error("Error submitting to Google Sheets:", error);
            }
          }

          setTimeout(() => {
            setIsSubmitting(false);
            setStep("success");
          }, 1500);
        };

        return (
          <div className="min-h-screen text-white font-sans relative bg-[#0f281e] overflow-x-hidden flex flex-col">
            <audio
              ref={clickSoundRef}
              src="https://assets.mixkit.co/active_storage/sfx/2568/2568-preview.mp3"
              preload="auto"
            />

            {/* ëˆˆ ë‚´ë¦¬ëŠ” ë°°ê²½ */}
            <div className="fixed inset-0 pointer-events-none z-0">
              {snowflakes.map((flake) => (
                <div
                  key={flake.id}
                  className="absolute text-white/40"
                  style={{
                    left: flake.left,
                    top: "-20px",
                    animation: `fall ${flake.animationDuration} linear infinite`,
                    opacity: flake.opacity,
                    fontSize: `${flake.size}px`,
                  }}
                >
                  â„
                </div>
              ))}
            </div>

            {/* ë¡œê³  */}
            <div className="relative z-20 w-full text-center pt-8 pb-4 flex-none">
              <h1 className="text-4xl font-dancing font-bold tracking-widest text-[#e8c660] drop-shadow-md">
                TEABLESS
              </h1>
              <div className="flex justify-center items-center gap-2 text-xs text-[#e8c660]/90 mt-1 font-mincho font-bold tracking-widest">
                <span>â˜…</span>
                <span>ãƒ†ã‚£ãƒ¼ãƒ–ãƒ¬ã‚¹</span>
                <span>â˜…</span>
              </div>
            </div>

            <main className="relative z-10 w-full max-w-md mx-auto flex-1 flex flex-col items-center justify-center p-6 pb-12">
              {/* INTRO */}
              {step === "intro" && (
                <div className="text-center space-y-6 animate-fade-in w-full flex flex-col items-center flex-1 justify-center">
                  <div className="relative py-4 flex flex-col items-center">
                    <div className="relative mb-6 w-56 h-56 flex items-center justify-center">
                      <div className="absolute inset-0 bg-[#d63031]/30 blur-[60px] rounded-full animate-pulse"></div>
                      <div className="absolute inset-0 bg-[#e8c660]/10 blur-[40px] rounded-full mix-blend-screen"></div>

                      <img
                        src="https://i.imgur.com/gfbvDNB.png"
                        alt="Santa Teabless"
                        className="relative z-10 w-full h-full object-contain drop-shadow-2xl"
                        style={{
                          animation: "float 4s ease-in-out infinite",
                          maskImage:
                            "linear-gradient(to bottom, black 60%, transparent 100%)",
                          WebkitMaskImage:
                            "linear-gradient(to bottom, black 60%, transparent 100%)",
                        }}
                      />

                      <div className="absolute inset-0 z-20 pointer-events-none">
                        <div className="absolute top-[20%] right-[20%] text-[#e8c660] animate-pulse opacity-80 text-sm">
                          âœ¨
                        </div>
                        <div className="absolute top-[10%] left-[30%] text-white opacity-60 text-xs">
                          â˜…
                        </div>
                      </div>
                    </div>

                    <div className="relative z-10 flex flex-col items-center -mt-6 w-full">
                      <h2 className="text-3xl font-extrabold leading-tight text-white drop-shadow-xl flex items-center justify-center gap-2 whitespace-nowrap">
                        <span className="text-[#d63031] font-chewy text-4xl transform -rotate-6 pt-1">
                          Santa
                        </span>
                        <span>ã«ãªã‚ã†ï¼</span>
                      </h2>
                    </div>
                  </div>

                  <div className="bg-white/5 backdrop-blur-md p-6 rounded-2xl border border-white/10 shadow-lg w-full max-w-xs mx-auto">
                    <p className="text-white/90 text-sm leading-7 text-pretty font-medium break-keep">
                      å¤§åˆ‡ãªã‚ã®äººã‚’æ€ã„æµ®ã‹ã¹ãªãŒã‚‰ã€<br />
                      ãã®äººã«ã´ã£ãŸã‚Šã®ã‚®ãƒ•ãƒˆã‚’
                      <br />
                      é¸ã‚“ã§ã¿ã¾ã›ã‚“ã‹ï¼Ÿ<br />
                      <br />
                      ãƒ†ã‚£ãƒ¼ãƒ–ãƒ¬ã‚¹ãŒã‚ãªãŸã®
                      <br />
                      æ¸©ã‹ã„æ°—æŒã¡ã‚’ãŠå±Šã‘ã—ã¾ã™ã€‚
                    </p>
                  </div>

                  <button
                    onClick={() => {
                      playClickSound();
                      setStep("quiz");
                    }}
                    className="w-full max-w-xs group bg-[#d63031] hover:bg-[#ff7675] text-white px-8 py-4 rounded-2xl font-bold transition-all flex items-center justify-center gap-2 shadow-lg shadow-red-900/40 transform hover:-translate-y-1 mt-4"
                  >
                    ã‚®ãƒ•ãƒˆé¸ã³ã‚’å§‹ã‚ã‚‹
                    <span className="group-hover:translate-x-1 transition-transform">
                      âœ
                    </span>
                  </button>
                </div>
              )}

              {/* QUIZ */}
              {step === "quiz" && (
                <div
                  key={currentQIdx}
                  className="w-full max-w-sm space-y-6 animate-fade-in flex flex-col flex-1 justify-center py-4"
                >
                  <div className="w-full bg-white/10 h-1.5 rounded-full mb-2 overflow-hidden shrink-0">
                    <div
                      className="bg-[#e8c660] h-full transition-all duration-500 ease-out"
                      style={{
                        width: `${
                          ((currentQIdx + 1) / QUESTIONS.length) * 100
                        }%`,
                      }}
                    ></div>
                  </div>

                  <div className="flex justify-center mb-1 shrink-0">
                    <div className="bg-white/10 p-4 rounded-full backdrop-blur-md shadow-inner border border-white/5 text-2xl">
                      {QUESTION_ICONS[currentQIdx]}
                    </div>
                  </div>

                  <h3 className="text-xl font-bold text-center leading-relaxed text-pretty min-h-[4rem] flex items-center justify-center drop-shadow-md px-2 break-keep shrink-0 whitespace-pre-line">
                    {QUESTIONS[currentQIdx].text}
                  </h3>

                  <div className="grid grid-cols-1 gap-3 pt-2 w-full">
                    {QUESTIONS[currentQIdx].options.map((opt, idx) => (
                      <button
                        key={`${currentQIdx}-${idx}`}
                        onClick={() => handleAnswer(opt.value)}
                        className="w-full bg-white/5 active:bg-[#e8c660] active:text-[#1a2e25] active:scale-95 border border-white/10 p-4 rounded-2xl text-left transition-all flex items-center justify-center group backdrop-blur-sm shadow-sm"
                      >
                        <span className="font-medium text-center">{opt.text}</span>
                      </button>
                    ))}
                  </div>

                  <div className="text-center text-xs text-white/30 mt-2 font-bold shrink-0">
                    {currentQIdx + 1} / {QUESTIONS.length}
                  </div>
                </div>
              )}

              {/* LOADING */}
              {step === "loading" && (
                <div className="text-center space-y-6 animate-pulse px-6 flex-1 flex flex-col justify-center items-center">
                  <div className="relative inline-block">
                    <div className="absolute inset-0 bg-[#e8c660] blur-2xl opacity-20 rounded-full animate-pulse"></div>
                    <div className="text-5xl relative z-10">âœ¨</div>
                  </div>
                  <p className="text-xl font-bold text-white leading-relaxed text-pretty">
                    å¤§åˆ‡ãªã‚ã®äººã«
                    <br />
                    ã´ã£ãŸã‚Šã®
                    <br />
                    é¦™ã‚Šã‚’ãƒ©ãƒƒãƒ”ãƒ³ã‚°ä¸­...
                  </p>
                </div>
              )}

              {/* RESULT */}
              {step === "result" && finalChoice && (
                <div className="w-full max-w-sm animate-fade-in pt-4 pb-20">
                  <div className="text-center mb-6">
                    <span className="bg-[#d63031] text-white px-4 py-1.5 rounded-full text-xs font-bold tracking-wider mb-4 inline-block shadow-md border border-white/10">
                      {isSharedView ? "SANTA'S RECOMMENDATION" : "SANTA'S PICK"}
                    </span>
                    <h3 className="text-2xl font-extrabold drop-shadow-md leading-relaxed text-pretty">
                      {/* ê³µìœ ëœ í™”ë©´ì¼ ë•ŒëŠ” íƒ€ì´í‹€ì„ ë‹¤ë¥´ê²Œ í‘œì‹œ */}
                      {isSharedView ? (
                        <>
                          <span className="text-[#e8c660] border-b-2 border-[#e8c660]/50 pb-1 px-1 inline-block">
                            å¤§åˆ‡ãªäºº
                          </span>
                          ã¸ã®
                          <br />
                          ãŠã™ã™ã‚ã‚®ãƒ•ãƒˆ
                        </>
                      ) : (
                        <>
                          <span className="text-[#e8c660] border-b-2 border-[#e8c660]/50 pb-1 px-1 inline-block">
                            {
                              QUESTIONS[0].options.find(
                                (o) => o.value === answers[0]
                              )?.text || "å¤§åˆ‡ãªäºº"
                            }
                          </span>
                          ã¸ã®
                          <br />
                          ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆ
                        </>
                      )}
                    </h3>
                  </div>

                  <div className="bg-white/95 backdrop-blur-xl rounded-3xl p-6 text-slate-800 shadow-2xl relative overflow-hidden mb-6 transition-all group border-4 border-white/20">
                    <a
                      href={finalChoice.link}
                      target="_blank"
                      rel="noreferrer"
                      className="block relative cursor-pointer group-hover:scale-[1.02] transition-transform duration-300"
                    >
                      <div className="w-full aspect-square bg-slate-100 rounded-2xl mb-5 flex flex-col items-center justify-center text-slate-300 relative overflow-hidden border border-slate-200">
                        <img
                          src={finalChoice.image}
                          alt={finalChoice.name}
                          className="w-full h-full object-cover"
                          onError={(e) => {
                            e.target.onerror = null;
                            e.target.src =
                              "https://placehold.co/400x400/e2e8f0/64748b?text=Teabless";
                          }}
                        />
                        <div className="absolute bottom-2 right-2 bg-black/50 text-white text-[10px] px-2 py-1 rounded-full flex items-center gap-1 backdrop-blur-sm">
                          ğŸ”— <span>è©³ç´°ã¯ã‚³ãƒãƒ©</span>
                        </div>
                      </div>
                    </a>

                    <div className="relative z-10">
                      <div className="flex justify-between items-start mb-2">
                        <h4
                          className={`text-xs font-bold uppercase tracking-wider py-1 px-2 rounded-md ${finalChoice.color} ${finalChoice.accent}`}
                        >
                          Best Match
                        </h4>
                      </div>

                      <h2 className="text-xl font-extrabold mb-1 leading-tight text-slate-900 text-pretty break-words">
                        {finalChoice.name}
                      </h2>
                      <p className="text-xs text-slate-500 mb-4 font-bold">
                        {finalChoice.items}
                      </p>

                      <div className="flex gap-1.5 mb-5 flex-wrap">
                        {finalChoice.tags.map((tag) => (
                          <span
                            key={tag}
                            className="text-[11px] bg-slate-100 border border-slate-200 text-slate-600 px-2.5 py-1 rounded-full font-bold"
                          >
                            #{tag}
                          </span>
                        ))}
                      </div>

                      <div className="bg-[#f8f9fa] p-4 rounded-2xl border border-slate-100 mb-4 w-full">
                        <p className="text-sm text-slate-700 leading-relaxed font-medium text-pretty break-words whitespace-normal">
                          "{finalChoice.desc}"
                        </p>
                      </div>

                      <div className="flex items-center gap-3">
                        <div className="w-8 h-8 rounded-full bg-[#e8c660]/20 flex items-center justify-center shrink-0">
                          âœ¨
                        </div>
                        <div className="flex-1 min-w-0">
                          <p className="text-[10px] text-slate-400 font-bold uppercase tracking-wider mb-0.5">
                            Scent Note
                          </p>
                          <p className="text-sm font-bold text-slate-800 text-pretty break-words leading-tight">
                            {finalChoice.scent}
                          </p>
                        </div>
                      </div>
                    </div>
                  </div>
                  
                  {/* LINE ê³µìœ  ë²„íŠ¼ */}
                  <div className="mb-8 flex justify-center">
                    <button
                      onClick={handleLineShare}
                      className="bg-[#06C755] hover:bg-[#05b34c] text-white px-6 py-3 rounded-full font-bold text-sm flex items-center gap-2 shadow-lg transition-all active:scale-95"
                    >
                      <span className="text-lg">ğŸ’¬</span>
                      <span>LINEã§çµæœã‚’ã‚·ã‚§ã‚¢</span>
                    </button>
                  </div>

                  {/* ê³µìœ ë°›ì€ ì‚¬ëŒì—ê²ŒëŠ” ë‹¤ë¥¸ ì œí’ˆ ì„ íƒ ì˜µì…˜ì„ ìˆ¨ê¸°ê³ , "ë‚˜ë„ í•˜ê¸°" ìœ ë„ */}
                  {!isSharedView ? (
                    <div className="bg-[#1a4c3a]/80 backdrop-blur-md rounded-2xl p-5 border border-[#e8c660]/20 mb-8 shadow-lg">
                      <div className="flex items-center gap-2 mb-4">
                        <span>ğŸ”</span>
                        <h4 className="text-white font-bold text-sm">
                          ä»–ã®é¦™ã‚Šã«å¤‰æ›´ã—ã¾ã™ã‹ï¼Ÿ
                        </h4>
                      </div>

                      <div className="space-y-2 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
                        {PRODUCTS.map((prod) => (
                          <button
                            key={prod.id}
                            onClick={() => {
                              playClickSound();
                              setFinalChoice(prod);
                            }}
                            className={`w-full p-3 rounded-xl text-left text-sm transition-all border flex items-center justify-between
                        ${
                          finalChoice.id === prod.id
                            ? "bg-[#e8c660] border-[#e8c660] text-[#1a2e25] font-extrabold shadow-md transform scale-[1.02]"
                            : "bg-white/5 border-white/5 text-white/70 active:bg-white/10"
                        }`}
                          >
                            <div className="flex flex-col items-start gap-1 w-[85%]">
                              <span
                                className={`text-[10px] uppercase tracking-wider w-full ${
                                  finalChoice.id === prod.id
                                    ? "text-[#1a2e25]/80 font-bold"
                                    : "text-[#e8c660] opacity-90"
                                }`}
                              >
                                {prod.scent}
                              </span>
                              <span className="font-medium text-sm text-left leading-tight text-pretty break-words w-full">
                                {prod.name}
                              </span>
                            </div>
                            {finalChoice.id === prod.id && (
                              <span className="shrink-0">âœ”ï¸</span>
                            )}
                          </button>
                        ))}
                      </div>
                    </div>
                  ) : (
                    // ê³µìœ ë°›ì€ ì‚¬ëŒì´ ë³´ëŠ” ì•ˆë‚´ ë¬¸êµ¬
                    <div className="text-center mb-8 px-4">
                      <p className="text-sm text-white/80 leading-relaxed">
                        ã‚ãªãŸã‚‚ã‚µãƒ³ã‚¿ã«ãªã£ã¦<br/>
                        å¤§åˆ‡ãªäººã«ã‚®ãƒ•ãƒˆã‚’è´ˆã‚Šã¾ã›ã‚“ã‹ï¼Ÿ
                      </p>
                    </div>
                  )}

                  <div className="mt-8 mb-4 sticky bottom-6 z-30">
                    {/* ê³µìœ ë°›ì€ ìƒíƒœ(isSharedView)ë©´ 'ë‚˜ë„ ì§„ë‹¨í•˜ê¸°' ë²„íŠ¼, ì•„ë‹ˆë©´ 'ì„ ë¬¼ í™•ì •' ë²„íŠ¼ */}
                    {isSharedView ? (
                      <button
                        onClick={resetApp} // ì´ˆê¸°í™”í•˜ê³  ì²˜ìŒë¶€í„° ì‹œì‘
                        className="w-full bg-[#e8c660] text-[#1a2e25] py-4 rounded-2xl font-bold text-lg active:bg-white active:scale-95 transition-all shadow-lg flex items-center justify-center gap-2"
                      >
                        <span>ğŸ…</span>
                        <span>ç§ã‚‚ã‚µãƒ³ã‚¿è¨ºæ–­ã‚’ã™ã‚‹</span>
                      </button>
                    ) : (
                      <button
                        onClick={() => {
                          playClickSound();
                          setStep("form");
                        }}
                        className="w-full bg-[#d63031] text-white py-4 rounded-2xl font-bold text-lg active:bg-[#ff7675] active:scale-95 transition-all shadow-[0_0_25px_rgba(214,48,49,0.6)] flex items-center justify-center gap-2 border-2 border-white/10"
                      >
                        <span>ğŸ</span>
                        <span>ã“ã®ã‚®ãƒ•ãƒˆã§ç¢ºå®šã™ã‚‹</span>
                      </button>
                    )}
                  </div>
                </div>
              )}

              {/* FORM */}
              {step === "form" && (
                <div className="w-full max-w-xs animate-fade-in pt-4 pb-12 flex-1 flex flex-col justify-center">
                  <div className="text-center mb-6 pt-2">
                    <div className="inline-block p-4 bg-white/10 rounded-full mb-4 backdrop-blur-md border border-white/10 text-3xl">
                      âœ‰ï¸
                    </div>
                    <h3 className="text-2xl font-extrabold drop-shadow-md">
                      ç”³ã—è¾¼ã¿æƒ…å ±ã®å…¥åŠ›
                    </h3>
                    <p className="text-sm text-white/80 mt-3 leading-relaxed text-pretty">
                      <span className="text-[#e8c660] font-bold">
                        "{finalChoice?.name}"
                      </span>
                      ãƒ©ã‚¤ãƒ³ã‹ã‚‰
                      <br />
                      è´ˆã‚ŠãŸã„è£½å“ã¨ç†ç”±ã€
                      <br />
                      è³¼å…¥ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚
                    </p>
                     
                    <div className="mt-4 bg-[#d63031]/20 border border-[#d63031] text-[#ff7675] text-xs font-bold px-3 py-1 rounded-full inline-block animate-pulse">
                      ğŸ æƒ³ã„ãŒä¼ã‚ã‚‹ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã§å½“é¸ç¢ºç‡UPï¼
                    </div>
                  </div>

                  <form
                    onSubmit={handleFinalSubmit}
                    className="space-y-5 bg-white/5 p-6 rounded-3xl border border-white/10 backdrop-blur-md shadow-xl"
                  >
                    <div>
                      <label className="block text-xs font-bold text-[#e8c660] mb-2 ml-1 flex items-center gap-1">
                        âœï¸ å¸Œæœ›ã™ã‚‹è£½å“ (ä»»æ„)
                      </label>
                      <input
                        type="text"
                        placeholder="ä¾‹ï¼šãƒ­ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¦ã‚©ãƒƒã‚·ãƒ¥ãªã©"
                        className="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#e8c660] focus:bg-black/30 focus:outline-none transition-colors text-sm"
                        value={formData.preferredItem}
                        onChange={(e) =>
                          setFormData({
                            ...formData,
                            preferredItem: e.target.value,
                          })
                        }
                      />
                      <p className="text-[10px] text-white/40 mt-1 ml-1">
                        â€» ã“ã®é¦™ã‚Šã®ãƒ©ã‚¤ãƒ³ãƒŠãƒƒãƒ—ã‹ã‚‰æ¬²ã—ã„è£½å“ãŒã‚ã‚Œã°è¨˜å…¥ã—ã¦ãã ã•ã„ã€‚æœªå…¥åŠ›ã®å ´åˆã¯ãƒ©ãƒ³ãƒ€ãƒ ã«ãªã‚Šã¾ã™ã€‚
                      </p>
                    </div>

                    <div>
                      <label className="block text-xs font-bold text-[#e8c660] mb-2 ml-1">
                        ğŸ ãƒ—ãƒ¬ã‚¼ãƒ³ãƒˆã‚’è´ˆã‚ŠãŸã„ç†ç”±
                      </label>
                      <textarea
                        required
                        onInvalid={(e) => e.target.setCustomValidity('ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚')}
                        onInput={(e) => e.target.setCustomValidity('')}
                        rows="4"
                        placeholder="ä¾‹ï¼šã„ã¤ã‚‚ãŠä¸–è©±ã«ãªã£ã¦ã„ã‚‹æ¯ã¸ã€å†¬ã®å¯’ã•ã‚’å¿˜ã‚Œã‚‹ã‚ˆã†ãªæ¸©ã‹ã„é¦™ã‚Šã‚’è´ˆã‚ŠãŸãã¦..."
                        className="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#e8c660] focus:bg-black/30 focus:outline-none resize-none transition-colors leading-relaxed"
                        value={formData.story}
                        onChange={(e) =>
                          setFormData({ ...formData, story: e.target.value })
                        }
                      />
                    </div>

                    {/* ì„ íƒ ì…ë ¥ ì„¹ì…˜ */}
                    <div className="pt-2 border-t border-white/10 mt-2">
                        <p className="text-xs text-center text-white/60 mb-4">
                          ä»¥ä¸‹ã€ã©ã¡ã‚‰ã‹ä¸€æ–¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„
                        </p>

                        {/* ì£¼ë¬¸ë²ˆí˜¸ ì…ë ¥ */}
                        <div className="mb-4">
                         <label className="block text-xs font-bold text-[#e8c660] mb-2 ml-1 flex items-center gap-1">
                            ğŸ§¾ è³¼å…¥æ¸ˆã¿ã®æ–¹ã¯æ³¨æ–‡ç•ªå·
                         </label>
                         <input
                          id="purchase-input-final"
                          type="text"
                          onInvalid={(e) => e.target.setCustomValidity('æ³¨æ–‡ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚')}
                          onInput={(e) => e.target.setCustomValidity('')}
                          placeholder="ä¾‹) 20251225"
                          className="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#e8c660] focus:bg-black/30 focus:outline-none transition-all text-sm tracking-wider"
                          value={purchaseNumber}
                          onChange={(e) => setPurchaseNumber(e.target.value)}
                        />
                      </div>

                      <div className="flex items-center gap-3 my-2 opacity-50">
                        <div className="h-px bg-white/30 flex-1"></div>
                        <span className="text-[10px] text-white">OR</span>
                        <div className="h-px bg-white/30 flex-1"></div>
                      </div>

                      {/* ì´ë©”ì¼ ì…ë ¥ */}
                      <div>
                        <label className="block text-xs font-bold text-[#e8c660] mb-2 ml-1 flex items-center gap-1">
                           ğŸ“§ æœªè³¼å…¥ã®æ–¹ã¯ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                        </label>
                        <input
                          type="email"
                          onInvalid={(e) => {
                            if(e.target.validity.typeMismatch) {
                                e.target.setCustomValidity('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã®å½¢å¼ã§å…¥åŠ›ã—ã¦ãã ã•ã„ (@ã‚’å«ã‚ã¦ãã ã•ã„)ã€‚');
                            } else {
                                e.target.setCustomValidity('ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„ã€‚');
                            }
                          }}
                          onInput={(e) => e.target.setCustomValidity('')}
                          placeholder="example@email.com"
                          className="w-full bg-black/20 border border-white/10 rounded-xl px-4 py-3 text-white focus:border-[#e8c660] focus:bg-black/30 focus:outline-none transition-all text-sm"
                          value={email}
                          onChange={(e) => setEmail(e.target.value)}
                        />
                      </div>
                    </div>

                    <button
                      type="submit"
                      disabled={isSubmitting}
                      className="w-full mt-2 bg-[#e8c660] text-[#1a2e25] py-4 rounded-xl font-bold text-lg active:bg-white transition-colors shadow-lg disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2"
                    >
                      {isSubmitting ? "é€ä¿¡ä¸­..." : "ã‚µãƒ³ã‚¿ã«å¿œå‹Ÿã™ã‚‹"}
                    </button>
                  </form>
                </div>
              )}

              {/* SUCCESS */}
              {step === "success" && (
                <div className="text-center animate-scale-in w-full max-w-sm flex-1 flex flex-col justify-center">
                  <div className="relative inline-block mb-8">
                    <div className="absolute inset-0 bg-[#e8c660] blur-2xl opacity-20 rounded-full animate-pulse"></div>
                    <div className="relative z-10 flex items-center justify-center text-6xl">
                      âœ…
                    </div>
                  </div>

                  <h2 className="text-3xl font-extrabold text-[#e8c660] mb-4 drop-shadow-md">
                    ç”³è«‹å®Œäº†!
                  </h2>
                  <p className="text-white/90 leading-relaxed mb-10 text-base font-medium text-pretty">
                    ã‚¤ãƒ™ãƒ³ãƒˆã«ã”å‚åŠ ã„ãŸã ã
                    <br />
                    ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ã€‚
                    <br />
                    <br />
                    ã‚ãªãŸã®æ¸©ã‹ã„ã‚¨ãƒ”ã‚½ãƒ¼ãƒ‰ãŒ
                    <br />
                    ãã£ã¨ã‚¯ãƒªã‚¹ãƒã‚¹ã®å¥‡è·¡ã‚’
                    <br />
                    èµ·ã“ã™ã§ã—ã‚‡ã†ã€‚
                  </p>

                  <div className="bg-white/10 p-6 rounded-2xl border border-white/10 mb-10 text-sm text-left backdrop-blur-md shadow-lg relative overflow-hidden">
                    <div className="absolute top-0 right-0 p-2 opacity-10 text-6xl">
                      ğŸ
                    </div>
                    <p className="text-[#e8c660] text-xs font-bold mb-4 uppercase tracking-wider border-b border-white/10 pb-2">
                      Your Pick
                    </p>
                    <div className="space-y-3">
                      <div className="flex justify-between items-start border-b border-white/5 pb-2 mb-2">
                        <span className="text-white/60 font-medium mt-1 shrink-0">
                          Scent.
                        </span>
                        <span className="font-bold text-white text-right w-2/3 text-pretty">
                          {finalChoice?.name}
                        </span>
                      </div>
                      <div className="flex justify-between items-start">
                        <span className="text-white/60 font-medium mt-1 shrink-0">
                          Item.
                        </span>
                        <span className="font-bold text-[#e8c660] text-right w-2/3 text-pretty">
                          {formData.preferredItem || "ãƒ©ãƒ³ãƒ€ãƒ "}
                        </span>
                      </div>
                      
                      {/* ì…ë ¥ëœ ì—°ë½ì²˜ ì •ë³´(ì£¼ë¬¸ë²ˆí˜¸ ë˜ëŠ” ì´ë©”ì¼) í‘œì‹œ */}
                      <div className="flex justify-between items-start mt-2 pt-2 border-t border-white/5">
                        <span className="text-white/60 font-medium shrink-0">
                          Contact.
                        </span>
                        <span className="font-mono text-white/80 text-right text-xs break-all">
                          {purchaseNumber ? `Order: ${purchaseNumber}` : email}
                        </span>
                      </div>
                    </div>
                  </div>

                  <button
                    onClick={resetApp}
                    className="text-white/50 text-sm hover:text-white font-bold transition-colors flex items-center justify-center gap-2 mx-auto pb-4"
                  >
                    ğŸ” æœ€åˆã«æˆ»ã‚‹
                  </button>
                </div>
              )}
            </main>
          </div>
        );
      }

      const root = ReactDOM.createRoot(document.getElementById("root"));
      root.render(<App />);
    </script>
  </body>
</html>
